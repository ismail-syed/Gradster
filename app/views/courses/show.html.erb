<div class="title">
  <h1 class="page-header">
  	<%= link_to @course.name.upcase, edit_course_path(@course) %>
  	<div class="add_component_button">
		<%= link_to 'Add Component', '#AddComponentModal', 'data-toggle' => 'modal',	:class => 'btn btn-success' %>
		<%= link_to 'Edit Course', edit_course_path,	:class => 'btn btn-default' %>

	</div>
  </h1>

</div>

<% @course.grade = 0.0 %>

<ol>
	<% @course.components.each do |component| %>
		<li> <%= component.name %>: <%= component.weight %>%  </li>
	<% end %> 
</ol>

<div class="components">
	<span>
    	<ol>
    		<!-- COMPONENTS -->
    		<table class='table' id="components_table"> 
    			<tbody>
    				<% @course.components.each do |component| %>
						  <tr>
								<% component.grade = Evaluation.where(:component_id => component.id).average(:mark).to_f.round(2) %>
								<% comp_grade_weight =  ( (component.component_weight.to_f/100) * (Evaluation.where(:component_id => component.id).average(:mark).to_f.round(2)) ).round(3) %> 

								<div class="component">
							  	<li id="component-list-item">

								

									<div class="container">
									    <div class="row">
									        <div class="col-md-11">
									            <div class="panel panel-primary">
									                
									                <div class="panel-heading clickable">
									                    <h3 class="panel-title">
									                        <strong> 
									    											<span class="expandable-title"> 
																						
								    												<%= link_to component.name, edit_course_component_path(@course, component), :remote => false %> :	<%= component.component_weight %>% 

									    												<div class="component-grade"> <%= component.grade %>% </div>
									    											</span>
																			    </strong> 
																			</h3>
									                    <span class="pull-right "><i class="glyphicon glyphicon-minus"></i></span>
									                </div>

									                <div class="panel-body">
									                   <div id="marks">
																	  		<ul>
																	  			<% if component.evaluations.all.count == 0 %>
																	  				<div id="add-mark-message"> Add some marks in! </div>
																		  		<% else %>
																		  			<strong> Marks: </strong> 
																			  		<% component.evaluations.each do |eval| %>
																			  			<li> 
																			  				<%= eval.mark %>%  
																			  				<%= link_to "Remove Mark", course_component_evaluation_path(eval.component.course,
																			  				 		eval.component, eval), method: :delete %> 
																			  			</li>
																			  		<% end %>
																		  		<% end %> 
																	  		</ul>
																	    </div>

																		<div id="component-grading">
																	  	<% unless comp_grade_weight == 0.0 %>
																			  <em>Component Grade: <%= component.grade %></em> 
																			  <br />
													  						<em> Component Weight Grade: <%= comp_grade_weight %>  </em>
																				<% @course.grade += comp_grade_weight %>
																	    	</br> Total Summation: <%= @course.grade %>
																		 <% end %> 
											  						</div>

									                </div>
									            </div>
									        </div>
									    </div>
										</div>
										</li>
									</div>
								</tr>
				    	<% component.save %> 
					  <% end %>
			    </tbody>
			  </table>

    		<!-- FINAL COURSE GRADE -->
    		<% if (@course.components.all.count == 0)  %> <!-- No components created -->
	    		<div class="add-comp-message"> 
	    			<span> <h3> Add a component to get started! </h3> </span>				 
	    		</div>
	    	<% else %>
	    		<div class="final-grade">
		    		<span> <h3> Grade: <%=  @course.grade.to_f %></h3> </span>  
		    		<% @course.save %> 				 
	    		</div>
	    	<% end %>

		<ol>
	</span>

</div>	
<%= link_to 'Back', courses_path %> 
</br> 

<!-- CREATE COMPONENT MODAL -->
<div class="modal fade" id="AddComponentModal" tabindex="-1" role="dialog" aria-labelledby="largeModal" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h2 class="modal-title" id="myModalLabel">Add Component</h2>
      </div>

      <div class="modal-body">
				<%= render :partial => 'components/form',  modal: true %>
      </div>

    
    </div>
  </div>
</div>
