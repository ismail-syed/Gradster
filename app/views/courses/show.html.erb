<div class="title">
  <h1 class="page-header">
  	<%= link_to @course.name.upcase, edit_course_path(@course) %>
  	<div class="add_component_button">
			<%= link_to 'Add Component', new_course_component_path(@course, @component), :class => 'btn btn-success'%>
			<a href="#" class="btn btn-sm btn-success" data-toggle="modal" data-target="#AddComponentModal">Modal</a>

		</div>
  </h1>

</div>

<% @course.grade = 0.0 %>

<div class="components">
	<span>
    	<ol>
    		<!-- COMPONENTS -->
		    <% @course.components.each do |component| %>
			    <% component.grade = Evaluation.where(:component_id => component.id).average(:mark).to_f.round(2) %>
			  	<% comp_grade_weight =  ( (component.component_weight.to_f/100) * (Evaluation.where(:component_id => component.id).average(:mark).to_f.round(2)) ).round(3) %> 
		    	<div class="component">
			    	<li>

						<div class="add-mark-btn">
							<%= link_to "Add Marks" ,new_course_component_evaluation_path(component.course, component, @evaluation), :class => 'btn btn-sm btn-info' %>
							</br>
						</div>

						<div class="container">
						    <div class="row">
						        <div class="col-md-11">
						            <div class="panel panel-primary">
						                <div class="panel-heading clickable">
						                    <h3 class="panel-title">
						                        <strong> 
						    											<span class="expandable-title"> 
						    												<a href="/courses/<%=component.course.id%>/components/<%=component.id%>/edit">
						    												 <%=component.name%>:	<%= component.component_weight %>% 
						    												</a>
						    												<div class="component-grade"> <%= component.grade %>% </div>
						    											</span>
																    </strong> 
																</h3>
						                    <span class="pull-right "><i class="glyphicon glyphicon-minus"></i></span>
						                </div>
						                <div class="panel-body">
						                   <div id="marks">
														  		<ul>
														  			<% if component.evaluations.all.count == 0 %>
														  				<div id="add-mark-message"> Add some marks in! </div>
															  		<% else %>
															  			<strong> Marks: </strong> 
																  		<% component.evaluations.each do |eval| %>
																  			<li> 
																  				<%= eval.mark %>%  
																  				<%= link_to "Remove Mark", course_component_evaluation_path(eval.component.course,
																  				 		eval.component, eval), method: :delete %> 
																  			</li>
																  		<% end %>
															  		<% end %> 
														  		</ul>
														    </div>

															<div id="component-grading">
														  	<% unless comp_grade_weight == 0.0 %>
																  <em>Component Grade: <%= component.grade %></em> 
																  <br />
										  						<em> Component Weight Grade: <%= comp_grade_weight %>  </em>
																	<% @course.grade += comp_grade_weight %>
														    	</br> Total Summation: <%= @course.grade %>
															 <% end %> 
								  						</div>
																					
						                </div>
						            </div>
						        </div>
						    </div>
							</div>
							</li>
						</div>
						<% component.save %> 
			    <% end %>

    		<!-- FINAL COURSE GRADE -->
    		<% if (@course.components.all.count == 0)  %> <!-- No components created -->
	    		<div class="add-comp-message"> 
	    			<span> <h3> Add a component to get started! </h3> </span>				 
	    		</div>

	    	<% else %>
	    		<div class="final-grade">
		    		<span> <h3> Grade: <%=  @course.grade.to_f %></h3> </span>  
		    		<% @course.save %> 				 
	    		</div>
	    	<% end %>	
		<ol>
	</span>
</div>	
<%= link_to 'Back', courses_path %> 

</br> 











<!-- MY MODAL -->

<div class="modal fade" id="AddComponentModal" tabindex="-1" role="dialog" aria-labelledby="largeModal" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h2 class="modal-title" id="myModalLabel">Create Component</h2>
      </div>

      <div class="modal-body">
        <form class="form-inline" role="form">
	        
	        <% @component = Component.new %>

	        <%= form_for [@course, @component] do |f| %>
						  <% if @component.errors.any? %>
						    <div id="error_explanation">
						      <h2><%= pluralize(@component.errors.count, "error") %> prohibited this component from being saved:</h2>

						      <ul>
						      <% @component.errors.full_messages.each do |msg| %>
						        <li><%= msg %></li>
						      <% end %>
						      </ul>
						    </div>
						  <% end %>

						  <div class="field text-center">
							  <%= f.text_field :name, :class => "form-control input-lg", :placeholder => "Component Name", :tabindex => "1" %>
						  </div> </br>
						  <div class="field text-center">
							  <%= f.number_field :component_weight, :class => "form-control input-lg", :placeholder => "Component Weight", :tabindex => "1" %>
						  </div>

						  <div class="actions col-md-4 text-center">
						  </div>
				
				      <div class="modal-footer">
				        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
				        <%= f.submit :value => "Create Component", :class => "btn btn-primary", :tabindex => "7" %>
				      </div>
					<% end %>

	      </form>
      </div>

    </div>
  </div>
</div>